/*
 * Code generated by Speakeasy (https://speakeasyapi.dev). DO NOT EDIT.
 */

package com.formance.formance_sdk.hooks;

//
// This file is written once by speakeasy code generation and 
// thereafter will not be overwritten by speakeasy updates. As a
// consequence any customization of this class will be preserved.
//

import com.formance.formance_sdk.utils.Helpers;
import com.formance.formance_sdk.utils.Hook;
import org.apache.http.client.utils.URIBuilder;

import java.net.URI;
import java.net.http.HttpRequest;

public final class SDKHooks {

    private SDKHooks() {
        // prevent instantiation
    }

    public static final void initialize(com.formance.formance_sdk.utils.Hooks hooks) {
        // register hooks here
        hooks.registerBeforeRequest(new Hook.BeforeRequest() {
            @Override
            public HttpRequest beforeRequest(Hook.BeforeRequestContext context, HttpRequest request) throws Exception {
                String uriRawPath = request.uri().getRawPath();

                if (uriRawPath.contains("%3A")){
                    // Replace path with decoded request.uri().getPath()
                    URI newUri = new URIBuilder(request.uri()).setPath(request.uri().getPath()).build();
                    HttpRequest nextRequest =  Helpers.copy(request)
                            .uri(newUri)
                            .build();

                    return nextRequest;
                }

                return request;
            }
        });
        // for more information see
        // https://www.speakeasyapi.dev/docs/additional-features/sdk-hooks
    }
}
